---
title: Calling auth API from CLI using cURL
layout: post
date: '2025-09-03 15:34:00'
category: Documentation
excerpt: Complete API documentation for Materio v2 with cURL and PowerShell examples covering authentication, profile management, chat AI, admin tools, CDN management, and premium account recovery features.
image: /assets/img/covers/b82d9728-d54f-41c9-85be-3b0e5dcea670.webp
summarize: true
permalink: /docs/api
hidden: true
---
# Materio API v2 Documentation

This document provides comprehensive examples for calling all API endpoints using curl, PowerShell, and bash.

## Table of Contents

1. [Base URL & Headers](#base-url--headers)
2. [Authentication Flow](#authentication-flow)
3. [User Authentication](#1-user-authentication)
   - [1.1 User Signup](#11-user-signup)
   - [1.2 User Login](#12-user-login)
   - [1.3 Password Recovery](#13-password-recovery)
   - [1.4 User Logout](#14-user-logout)
4. [User Profile Management](#2-user-profile-management)
   - [2.1 Get User Profile](#21-get-user-profile)
   - [2.2 Update User Profile](#22-update-user-profile)
   - [2.3 Delete User Account](#23-delete-user-account)
5. [Health Check](#3-health-check)
   - [3.1 Server Health](#31-server-health)
6. [Chat API](#4-chat-api)
   - [4.1 Chat Completion](#41-chat-completion)
   - [4.2 Get Available Models](#42-get-available-models)
7. [Invite Management](#5-invite-management)
   - [5.1 Validate Invite Code](#51-validate-invite-code)
   - [5.2 Toggle Admin Privileges](#52-toggle-admin-privileges-admin-only)
   - [5.3 Diagnostic Invite](#53-diagnostic-invite)
8. [CDN Management (Admin Only)](#6-cdn-management-admin-only)
   - [6.1 List CDN Files](#61-list-cdn-files)
   - [6.2 Upload File to CDN](#62-upload-file-to-cdn)
   - [6.3 Batch Upload to CDN](#63-batch-upload-to-cdn)
9. [Google Drive Integration](#7-google-drive-integration)
   - [7.1 Google Drive Authentication](#71-google-drive-authentication)
   - [7.2 Handle OAuth Callback](#72-handle-oauth-callback)
   - [7.3 List Google Drive Files](#73-list-google-drive-files)
   - [7.4 Upload to Google Drive](#74-upload-to-google-drive)
10. [Analytics & Insights](#8-analytics--insights)
    - [8.1 Real-time Users](#81-real-time-users)
11. [Download Management](#9-download-management)
    - [9.1 Download File](#91-download-file)
12. [Search API](#10-search-api)
    - [10.1 Simple Search](#101-simple-search-get)
    - [10.2 Advanced Search](#102-advanced-search-post)
    - [10.3 Search Examples](#103-search-examples)
    - [10.4 Search Configuration](#104-search-configuration)
13. [Error Responses](#error-responses)
14. [API Security](#api-security)
13. [API Security](#api-security)
14. [Development Setup](#development-setup)
15. [Testing Examples](#testing-examples)
16. [API Changelog](#api-changelog)
17. [Support & Troubleshooting](#support--troubleshooting)
18. [License & Usage](#license--usage)

---

## Base URL & Headers
- Development: `http://localhost:8888/api/v1`
- Production: `https://materioa.netlify.app/api/v1`
- Legacy Auth API URL: `https://auth-materioa.netlify.app/.netlify/functions`

## Common Headers
All requests should include:
```
Content-Type: application/json
```

For authenticated endpoints, include:
```
Authorization: Bearer YOUR_JWT_TOKEN
```

## Authentication Flow
1. **Signup** → Get JWT token + recovery key
2. **Login** → Get JWT token
3. **Use token** in Authorization header for protected endpoints
4. **Password recovery** → Use email + recovery key

---

## 1. User Authentication

### 1.1 User Signup

**Endpoint:** `POST /signup`

Creates a new user account with invite code validation.

#### Required Fields:
- username (string)
- displayName (string)
- email (string)
- password (string)
- inviteCode (string)
- profilePicture (optional, base64 data URL)

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/signup \
  -H "Content-Type: application/json" \
  -d '{
    "username": "johndoe",
    "displayName": "John Doe",
    "email": "john@example.com",
    "password": "securePassword123",
    "inviteCode": "INVITE123",
    "profilePicture": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."
  }'
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
}

$body = @{
    username = "johndoe"
    displayName = "John Doe"
    email = "john@example.com"
    password = "securePassword123"
    inviteCode = "INVITE123"
    profilePicture = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/signup" -Method POST -Headers $headers -Body $body
```

#### Response:
```json
{
  "message": "User created successfully",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "uuid",
    "username": "johndoe",
    "displayName": "John Doe",
    "email": "john@example.com",
    "hasAdminPrivileges": false,
    "isPlusUser": false,
    "profilePicture": "https://...",
    "recoveryKey": "recovery-key-string",
    "grantedPlusFromInvite": false
  }
}
```

### 1.2 User Login

**Endpoint:** `POST /login`

Authenticates user with username/email and password.

#### Required Fields:
- username (string) - Can be username or email
- password (string)

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "johndoe",
    "password": "securePassword123"
  }'
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
}

$body = @{
    username = "johndoe"
    password = "securePassword123"
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/login" -Method POST -Headers $headers -Body $body
```

#### Response:
```json
{
  "message": "Login successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "uuid",
    "username": "johndoe",
    "displayName": "John Doe",
    "email": "john@example.com",
    "hasAdminPrivileges": false,
    "isPlusUser": false,
    "profilePicture": "https://..."
  }
}
```

### 1.3 Password Recovery

**Endpoint:** `POST /forgot-password`

Resets user password using email and recovery key.

#### Required Fields:
- email (string)
- recoveryKey (string)
- newPassword (string, optional - if not provided, just validates recovery key)

#### cURL Example:
```bash
# Validate recovery key only
curl -X POST https://materioa.netlify.app/api/v2/forgot-password \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "recoveryKey": "recovery-key-string"
  }'

# Reset password
curl -X POST https://materioa.netlify.app/api/v2/forgot-password \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "recoveryKey": "recovery-key-string",
    "newPassword": "newSecurePassword123"
  }'
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
}

$body = @{
    email = "john@example.com"
    recoveryKey = "recovery-key-string"
    newPassword = "newSecurePassword123"
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/forgot-password" -Method POST -Headers $headers -Body $body
```

### 1.4 User Logout

**Note:** This API uses JWT (JSON Web Tokens) for authentication. Logout is handled client-side by discarding the token.

#### Client-Side Logout Process:
1. **Delete/Clear the JWT token** from your storage (memory, file, etc.)
2. **Stop including the token** in future requests
3. **Optional:** Clear any cached user data

#### cURL Example (Simulating Logout):
```bash
# After logout, requests without token will return 401 Unauthorized
curl -X GET https://materioa.netlify.app/api/v2/profile \
  -H "Content-Type: application/json"
  # No Authorization header = logged out state
```

#### PowerShell Example (Simulating Logout):
```powershell
# Clear the token variable
$token = $null

# Subsequent requests will fail without authentication
try {
    $headers = @{
        "Content-Type" = "application/json"
        # "Authorization" = "Bearer $token"  # No token = logged out
    }
    Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/profile" -Method GET -Headers $headers
}
catch {
    Write-Host "Successfully logged out - Authentication required"
}
```

#### Response (After Logout):
```json
{
  "error": "Authentication token required"
}
```

#### Security Best Practices:
- **Immediate Effect**: Unlike server-side sessions, JWT logout takes effect immediately
- **Token Security**: Never store tokens in plain text files or logs
- **Token Lifecycle**: Tokens expire automatically based on server configuration
- **Secure Storage**: Use secure storage mechanisms in production applications

---

## 2. User Profile Management

### 2.1 Get User Profile

**Endpoint:** `GET /profile`

Retrieves the authenticated user's profile information.

#### Headers Required:
- Authorization: Bearer YOUR_JWT_TOKEN

#### cURL Example:
```bash
curl -X GET https://materioa.netlify.app/api/v2/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "Authorization" = "Bearer YOUR_JWT_TOKEN"
}

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/profile" -Method GET -Headers $headers
```

#### Response:
```json
{
  "user": {
    "id": "uuid",
    "username": "johndoe",
    "displayName": "John Doe",
    "email": "john@example.com",
    "profilePicture": "https://...",
    "recoveryKey": "recovery-key-string",
    "hasAdminPrivileges": false,
    "isPlusUser": false,
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-01T00:00:00Z"
  }
}
```

### 2.2 Update User Profile

**Endpoint:** `PUT /profile`

Updates the authenticated user's profile information.

#### Headers Required:
- Authorization: Bearer YOUR_JWT_TOKEN

#### Optional Fields:
- username (string)
- displayName (string)
- currentPassword (string, required for password changes and recovery key generation)
- newPassword (string)
- generateNewRecoveryKey (boolean)
- profilePicture (string, base64 data URL)

#### cURL Example:
```bash
curl -X PUT https://materioa.netlify.app/api/v2/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "username": "newusername",
    "displayName": "New Display Name",
    "currentPassword": "currentPassword123",
    "newPassword": "newPassword123",
    "generateNewRecoveryKey": true
  }'
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "Authorization" = "Bearer YOUR_JWT_TOKEN"
}

$body = @{
    username = "newusername"
    displayName = "New Display Name"
    currentPassword = "currentPassword123"
    newPassword = "newPassword123"
    generateNewRecoveryKey = $true
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/profile" -Method PUT -Headers $headers -Body $body
```

### 2.3 Delete User Account

**Endpoint:** `DELETE /profile`

Permanently deletes the authenticated user's account.

#### Headers Required:
- Authorization: Bearer YOUR_JWT_TOKEN

#### Required Fields:
- password (string) - Current password for confirmation

#### cURL Example:
```bash
curl -X DELETE https://materioa.netlify.app/api/v2/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "password": "currentPassword123"
  }'
```

---

## 3. Health Check

### 3.1 Server Health

**Endpoint:** `GET /health`

Checks if the server is running and healthy.

#### cURL Example:
```bash
curl -X GET https://materioa.netlify.app/api/v2/health
```

#### PowerShell Example:
```powershell
Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/health" -Method GET
```

#### Response:
```json
{
  "status": "ok",
  "message": "Server is healthy",
  "timestamp": "2024-01-01T00:00:00Z",
  "service": "materio-api"
}
```

---

## 4. Chat API

### 4.1 Chat Completion

**Endpoint:** `POST /chat`

Sends a message to AI chat with different modes and models.

#### Required Fields:
- message (string)

#### Optional Fields:
- mode (string) - "general", "reasoning", "code" (default: "general")
- model (string) - Specific model to use
- messages (array) - Previous conversation context

#### Available Modes:
- **general**: Multi-purpose conversations
- **reasoning**: Complex problem-solving and analysis
- **code**: Programming and technical assistance

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Explain quantum computing",
    "mode": "reasoning",
    "messages": []
  }'
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
}

$body = @{
    message = "Write a Python function to sort a list"
    mode = "code"
    messages = @()
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/chat" -Method POST -Headers $headers -Body $body
```

### 4.2 Get Available Models

**Endpoint:** `GET /chat/models`

Returns available AI models categorized by mode.

#### cURL Example:
```bash
curl -X GET https://materioa.netlify.app/api/v2/chat/models
```

#### Response:
```json
{
  "success": true,
  "models": {
    "reasoning": ["google/gemma-3-27b-it:free", "meta-llama/llama-4-maverick:free"],
    "code": ["deepseek/deepseek-r1-0528-qwen3-8b:free", "qwen/qwen-2.5-coder-32b-instruct:free"],
    "general": ["google/gemini-2.0-flash-exp:free", "mistralai/mistral-small-3.2-24b-instruct:free"]
  }
}
```

---

## 5. Invite Management

### 5.1 Validate Invite Code

**Endpoint:** `POST /invites/validate`

Validates an invite code before signup.

#### Required Fields:
- inviteCode (string)

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/invites/validate \
  -H "Content-Type: application/json" \
  -d '{
    "inviteCode": "INVITE123"
  }'
```

### 5.2 Toggle Admin Privileges (Admin Only)

**Endpoint:** `POST /invites/toggle-admin`

Toggles admin privileges for a user.

#### Headers Required:
- Authorization: Bearer YOUR_ADMIN_JWT_TOKEN

#### Required Fields:
- targetUserId (string)

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/invites/toggle-admin \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_JWT_TOKEN" \
  -d '{
    "targetUserId": "user-uuid"
  }'
```

### 5.3 Diagnostic Invite

**Endpoint:** `POST /invites/diagnostic`

Gets detailed information about an invite code (Admin only).

#### Required Fields:
- inviteCode (string)

### 5.4 Premium Account Recovery (Admin Only)

**Endpoint:** `POST /admin-recovery`

Premium account recovery service for users who have lost both password and recovery key. Admin-only endpoint that returns complete user data including recovery key for manual password reset assistance.

#### Headers Required:
- Authorization: Bearer YOUR_ADMIN_JWT_TOKEN

#### Required Fields:
- email (string) - Target user's email address
- username (string) - Target user's username

#### Security Features:
- Requires exact match of both email AND username
- Admin privilege verification
- Audit logging of recovery attempts
- Does not return password hash

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/admin-recovery \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_JWT_TOKEN" \
  -d '{
    "email": "user@example.com",
    "username": "lostuser"
  }'
```

#### PowerShell Example:
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "Authorization" = "Bearer YOUR_ADMIN_JWT_TOKEN"
}

$body = @{
    email = "user@example.com"
    username = "lostuser"
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/admin-recovery" -Method POST -Headers $headers -Body $body
```

#### Response:
```json
{
  "message": "Account recovery data retrieved successfully",
  "recoveryService": "Premium Admin Account Recovery",
  "adminId": "admin-user-uuid",
  "targetUser": {
    "id": "target-user-uuid",
    "username": "lostuser",
    "displayName": "Lost User",
    "email": "user@example.com",
    "profilePicture": "https://...",
    "recoveryKey": "user-recovery-key-string",
    "hasAdminPrivileges": false,
    "isPlusUser": true,
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-01T00:00:00Z"
  },
  "securityNote": "This recovery includes the user's recovery key for password reset purposes",
  "timestamp": "2024-01-01T12:00:00Z"
}
```

#### Use Case:
This endpoint is designed for premium customer support scenarios where:
1. User has forgotten their password
2. User has lost/didn't save their recovery key
3. User can provide both email and username for verification
4. Admin assistance is required for account recovery

---

## 6. CDN Management (Admin Only)

### 6.1 List CDN Files

**Endpoint:** `GET /cdn?path=folder/path`

Lists files in the CDN repository.

#### Headers Required:
- Authorization: Bearer YOUR_ADMIN_JWT_TOKEN

#### Query Parameters:
- path (string, optional) - Folder path to list

#### cURL Example:
```bash
curl -X GET "https://materioa.netlify.app/api/v2/cdn?path=images" \
  -H "Authorization: Bearer YOUR_ADMIN_JWT_TOKEN"
```

### 6.2 Upload File to CDN

**Endpoint:** `POST /cdn`

Uploads a single file to the CDN.

#### Headers Required:
- Authorization: Bearer YOUR_ADMIN_JWT_TOKEN

#### Required Fields:
- filename (string)
- content (string) - Base64 encoded file content
- path (string, optional) - Target folder path

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/cdn \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_JWT_TOKEN" \
  -d '{
    "filename": "image.jpg",
    "content": "base64-encoded-content",
    "path": "images/"
  }'
```

### 6.3 Batch Upload to CDN

**Endpoint:** `POST /cdn?batch=true`

Uploads multiple files to the CDN in a single request.

#### Headers Required:
- Authorization: Bearer YOUR_ADMIN_JWT_TOKEN

#### Required Fields:
- files (array) - Array of file objects with filename, content, and path

---

## 7. Google Drive Integration

### 7.1 Google Drive Authentication

**Endpoint:** `GET /google-drive/auth`

Initiates Google Drive OAuth flow.

#### Headers Required:
- Authorization: Bearer YOUR_JWT_TOKEN

### 7.2 Handle OAuth Callback

**Endpoint:** `GET /google-drive/callback`

Handles Google OAuth callback and stores tokens.

### 7.3 List Google Drive Files

**Endpoint:** `GET /google-drive/files`

Lists files in user's Google Drive.

#### Headers Required:
- Authorization: Bearer YOUR_JWT_TOKEN

### 7.4 Upload to Google Drive

**Endpoint:** `POST /google-drive/upload`

Uploads a file to user's Google Drive.

#### Headers Required:
- Authorization: Bearer YOUR_JWT_TOKEN

---

## 8. Analytics & Insights

### 8.1 Real-time Users

**Endpoint:** `GET /insights`

Gets real-time user count from Google Analytics.

#### cURL Example:
```bash
curl -X GET https://materioa.netlify.app/api/v2/insights
```

#### Response:
```json
{
  "users": "42"
}
```

---

## 9. Download Management

### 9.1 Download File

**Endpoint:** `POST /dwn/downloads`

Downloads a file from a URL to local storage.

#### Required Fields:
- url (string)
- filename (string)
- title (string, optional)

#### cURL Example:
```bash
curl -X POST https://materioa.netlify.app/api/v2/dwn/downloads \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://example.com/file.pdf",
    "filename": "document.pdf",
    "title": "Important Document"
  }'
```

---

## 10. Search API

The Search API provides intelligent resource discovery across the Materio educational library using a hybrid approach combining algorithmic fuzzy matching (Fuse.js) and AI-powered semantic understanding (OpenRouter).

### Features

✅ **Fuzzy Matching** - Handles typos and partial matches  
✅ **Abbreviation Support** - Recognizes common abbreviations (e.g., "OS" → "Operating System", "DADV" → "Data Analytics and Data Visualization")  
✅ **Smart Scoring** - Weighs subject names higher than categories or items  
✅ **AI Fallback** - Uses AI when results are insufficient (50 queries/day limit)  
✅ **Fast & Scalable** - Works with expanding datasets across all branches  
✅ **CDN-Based** - Always fetches latest resource data from CDN  
✅ **Automatic Caching** - Reduces CDN load with intelligent caching (5-minute cache)

### Resource Library URLs
- **Production**: `https://cdn-materioa.netlify.app/databases/beta/resource.lib.json`
- **Development**: `http://localhost:8080/databases/beta/resource.lib.json`

### 10.1 Simple Search (GET)

**Endpoint:** `GET /search`

Quick search using query parameters.

**Query Parameters:**
- `q` or `query` (required) - The search query

#### cURL Example:
```bash
# Simple search for "os introduction"
curl "https://materioa.netlify.app/api/v2/search?q=os%20introduction"

# Search for "dadv qb"
curl "https://materioa.netlify.app/api/v2/search?query=dadv%20qb"
```

#### PowerShell Example:
```powershell
# Simple search
$query = "os introduction"
$encodedQuery = [System.Web.HttpUtility]::UrlEncode($query)
Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/search?q=$encodedQuery" -Method GET
```

#### Response:
```json
{
  "success": true,
  "query": "os introduction",
  "results": [
    {
      "semester": "4",
      "subject": "Operating System",
      "category": "Chapters",
      "item": "Introduction",
      "score": 95,
      "matchType": "high"
    }
  ],
  "count": 1,
  "method": "algorithmic"
}
```

### 10.2 Advanced Search (POST)

**Endpoint:** `POST /search`

Advanced search with AI fallback option and custom threshold.

**Request Body:**
```json
{
  "query": "dadv qb",
  "useAI": false,
  "threshold": 0.4
}
```

**Parameters:**
- `query` (required) - Search query
- `useAI` (optional, default: `false`) - Enable AI-powered search
- `threshold` (optional, default: `0.4`) - Fuse.js threshold (0.0 = perfect match, 1.0 = match anything)

#### cURL Example (Algorithmic):
```bash
curl -X POST https://materioa.netlify.app/api/v2/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "dadv qb",
    "useAI": false,
    "threshold": 0.4
  }'
```

#### cURL Example (With AI):
```bash
curl -X POST https://materioa.netlify.app/api/v2/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "EPJ servlets",
    "useAI": true
  }'
```

#### PowerShell Example:
```powershell
# Algorithmic search
$searchBody = @{
    query = "dadv qb"
    useAI = $false
    threshold = 0.4
} | ConvertTo-Json

$results = Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/search" `
    -Method POST `
    -Body $searchBody `
    -ContentType "application/json"

Write-Host "Found $($results.count) results"
$results.results | Format-Table

# AI-powered search
$aiSearchBody = @{
    query = "EPJ servlets"
    useAI = $true
} | ConvertTo-Json

$aiResults = Invoke-RestMethod -Uri "https://materioa.netlify.app/api/v2/search" `
    -Method POST `
    -Body $aiSearchBody `
    -ContentType "application/json"
```

#### Response (Algorithmic):
```json
{
  "success": true,
  "query": "dadv qb",
  "results": [
    {
      "semester": "5",
      "subject": "Data Analytics and Data Visualization",
      "category": "Question Banks",
      "item": "Question Bank",
      "score": 92,
      "matchType": "high"
    }
  ],
  "count": 1,
  "method": "algorithmic",
  "aiUsed": false
}
```

#### Response (With AI):
```json
{
  "success": true,
  "query": "EPJ servlets",
  "algorithmic": {
    "results": [...],
    "count": 5
  },
  "ai": {
    "intent": "User is looking for Servlet-related content in Enterprise Programming with Java",
    "rankings": [
      {
        "semester": "5",
        "subject": "Enterprise Programming with Java",
        "category": "Chapters",
        "item": "Servlets",
        "relevance": "high",
        "explanation": "Direct match to user's query"
      }
    ],
    "suggestions": ["java servlets", "epj web components"]
  },
  "method": "hybrid",
  "aiUsed": true
}
```

### 10.3 Search Examples

#### Example 1: Subject Abbreviation
**Query:** `"os introduction"`  
**Matches:** Operating System → Chapters → Introduction

```bash
curl "https://materioa.netlify.app/api/v2/search?q=os%20introduction"
```

#### Example 2: Multiple Abbreviations
**Query:** `"dadv qb"`  
**Matches:** Data Analytics and Data Visualization → Question Banks → Question Bank

```bash
curl "https://materioa.netlify.app/api/v2/search?q=dadv%20qb"
```

#### Example 3: Subject + Topic
**Query:** `"EPJ servlets"`  
**Matches:** Enterprise Programming with Java → Chapters → Servlets

```bash
curl "https://materioa.netlify.app/api/v2/search?q=EPJ%20servlets"
```

#### Example 4: Partial Match
**Query:** `"intro os"`  
**Matches:** Operating System → Chapters → Introduction

```bash
curl "https://materioa.netlify.app/api/v2/search?q=intro%20os"
```

#### Example 5: Full Text
**Query:** `"python flask"`  
**Matches:** Programming in Python with Full Stack → Chapters → Flask Framework

```bash
curl "https://materioa.netlify.app/api/v2/search?q=python%20flask"
```

### 10.4 Search Configuration

#### Algorithmic Search (Fuse.js)

**Index Building:**
- Subject names + abbreviations
- Category types + abbreviations
- Content items + abbreviations

**Weighted Scoring:**
- Subject: 40% weight
- Subject Abbreviations: 30% weight
- Item: 30% weight
- Item Abbreviations: 20% weight
- Category: 15% weight
- Category Abbreviations: 10% weight

**Fuse.js Options:**
```javascript
{
  threshold: 0.4,        // Lower = more strict matching
  distance: 100,         // Maximum search distance
  minMatchCharLength: 2, // Minimum characters to match
  ignoreLocation: true,  // Don't consider position in text
  includeScore: true,    // Return match scores
  useExtendedSearch: true
}
```

#### AI Search (Optional)

When `useAI: true`:
1. Runs algorithmic search first
2. Sends top 10 results to AI (Gemini 2.0 Flash via OpenRouter)
3. AI analyzes user intent
4. Returns ranked results with explanations
5. Suggests alternative search terms if needed

**AI Model:** `google/gemini-2.0-flash-exp:free`  
**Rate Limit:** 50 queries/day (OpenRouter free tier)

#### Performance Metrics

- **Algorithmic Search**: ~10-50ms (depends on dataset size)
- **AI Search**: ~1-3s (network latency + AI processing)
- **Recommended**: Use algorithmic first, AI as fallback

#### Testing Search API

Run local tests:
```bash
# Navigate to API directory
cd api/v1

# Run test script
node search.js
```

This will test common queries:
- "os introduction"
- "intro os"
- "dadv qb"
- "EPJ servlets"
- "data analytics question bank"
- "operating system chapter 1"
- "java enterprise programming"
- "cnip week 5"
- "python flask"

#### Smart Search Strategy (Frontend Integration)

```javascript
async function smartSearch(query) {
  // Try algorithmic first
  const response = await fetch(`/api/v2/search?q=${encodeURIComponent(query)}`);
  const data = await response.json();
  
  // If poor results, use AI
  if (data.results.length === 0 || data.results[0].score < 60) {
    const aiResponse = await fetch('/api/v2/search', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, useAI: true })
    });
    return await aiResponse.json();
  }
  
  return data;
}
```

---

## Error Responses

All endpoints may return these common error responses:

### 400 Bad Request
```json
{
  "error": "Missing required fields"
}
```

### 401 Unauthorized
```json
{
  "error": "Authentication token required"
}
```

### 403 Forbidden
```json
{
  "error": "Admin privileges required"
}
```

### 404 Not Found
```json
{
  "error": "User not found"
}
```

### 405 Method Not Allowed
```json
{
  "error": "Method not allowed"
}
```

### 409 Conflict
```json
{
  "error": "Email already exists"
}
```

### 500 Internal Server Error
```json
{
  "error": "Internal server error",
  "details": "Error message details"
}
```

---

## API Security

### Authentication Flow
1. **Register** with valid invite code → Receive JWT token + recovery key
2. **Login** with credentials → Receive JWT token
3. **Include token** in Authorization header: `Bearer YOUR_JWT_TOKEN`
4. **Token expires** → Re-login required
5. **Password recovery** → Use email + recovery key

### Security Features
- **JWT Tokens**: Secure session management
- **Password Hashing**: bcrypt with salt
- **Recovery Keys**: Unique keys for password recovery
- **Invite System**: Controlled user registration
- **Admin Privileges**: Role-based access control
- **CORS Protection**: Cross-origin request security

### Rate Limiting
- API endpoints may be rate limited
- Respect HTTP 429 responses
- Implement exponential backoff

---

## Development Setup

### Environment Variables Required
```bash
# Database
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key

# Authentication
JWT_SECRET=your_jwt_secret

# Google Drive Integration
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_REDIRECT_URI=your_redirect_uri

# Analytics
GA_SERVICE_ACCOUNT_KEY_BASE64=your_ga_service_account_key
GA4_PROPERTY_ID=your_ga4_property_id

# GitHub CDN
GITHUB_TOKEN=your_github_token

# Chat API
OPENROUTER_API_KEY=your_openrouter_api_key
```

### Local Development
```bash
# Install dependencies
npm install

# Start Netlify dev server
netlify dev

# API will be available at:
# https://materioa.netlify.app/api/v1
```

---

## Testing Examples

### 1. Complete User Flow
```bash
#!/bin/bash

# 1. Validate invite code
curl -X POST https://materioa.netlify.app/api/v2/invites/validate \
  -H "Content-Type: application/json" \
  -d '{"inviteCode": "TESTCODE123"}'

# 2. Sign up new user
SIGNUP_RESPONSE=$(curl -s -X POST https://materioa.netlify.app/api/v2/signup \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "displayName": "Test User",
    "email": "test@example.com",
    "password": "testpass123",
    "inviteCode": "TESTCODE123"
  }')

# Extract token from response
TOKEN=$(echo $SIGNUP_RESPONSE | jq -r '.token')

# 3. Get user profile
curl -X GET https://materioa.netlify.app/api/v2/profile \
  -H "Authorization: Bearer $TOKEN"

# 4. Update profile
curl -X PUT https://materioa.netlify.app/api/v2/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "displayName": "Updated Name"
  }'
```

### 2. PowerShell Testing Script
```powershell
# PowerShell complete flow
$baseUrl = "https://materioa.netlify.app/api/v1"

# Sign up
$signupBody = @{
    username = "testuser"
    displayName = "Test User"
    email = "test@example.com"
    password = "testpass123"
    inviteCode = "TESTCODE123"
} | ConvertTo-Json

$signupResponse = Invoke-RestMethod -Uri "$baseUrl/signup" -Method POST -Body $signupBody -ContentType "application/json"
$token = $signupResponse.token

# Get profile
$headers = @{
    "Authorization" = "Bearer $token"
    "Content-Type" = "application/json"
}

$profile = Invoke-RestMethod -Uri "$baseUrl/profile" -Method GET -Headers $headers
Write-Host "User Profile: $($profile | ConvertTo-Json -Depth 3)"

# Test chat
$chatBody = @{
    message = "Hello, how are you?"
    mode = "general"
} | ConvertTo-Json

$chatResponse = Invoke-RestMethod -Uri "$baseUrl/chat" -Method POST -Body $chatBody -ContentType "application/json"
Write-Host "Chat Response: $($chatResponse.response)"
```

### 3. Error Handling Examples
```bash
# Test invalid credentials
curl -X POST https://materioa.netlify.app/api/v2/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "invalid",
    "password": "wrong"
  }' | jq

# Test unauthorized access
curl -X GET https://materioa.netlify.app/api/v2/profile \
  -H "Authorization: Bearer invalid_token" | jq

# Test missing required fields
curl -X POST https://materioa.netlify.app/api/v2/signup \
  -H "Content-Type: application/json" \
  -d '{"username": "test"}' | jq
```

---

## API Changelog

### Version 2.0.0 (Current)
- Initial API release
- User authentication system
- Profile management
- Chat functionality with multiple AI models
- Invite system with admin controls
- CDN file management
- Google Drive integration
- Analytics insights
- Download management
- Health monitoring

### Upcoming Features
- File sharing system
- Advanced user roles
- API rate limiting
- Webhook support
- Enhanced analytics
- Mobile app APIs

---

## Support & Troubleshooting

### Common Issues

#### 1. Invalid JWT Token
- **Issue**: 401 Unauthorized responses
- **Solution**: Re-login to get fresh token
- **Check**: Token expiration, correct Authorization header format

#### 2. Invite Code Problems
- **Issue**: Invalid invite code during signup
- **Solution**: Validate invite code first using `/invites/validate`
- **Check**: Code spelling, expiration, usage limits

#### 3. CORS Errors
- **Issue**: Browser blocking requests
- **Solution**: Use proper origin headers
- **Check**: Request from allowed domains

#### 4. File Upload Issues
- **Issue**: CDN upload failures
- **Solution**: Check file size limits, base64 encoding
- **Check**: Admin privileges, GitHub token configuration

### Debug Mode
Add debug headers to requests:
```
X-Debug: true
```

### API Status
Check API health:
```bash
curl https://materioa.netlify.app/api/v2/health
```

### Contact Support
- GitHub Issues: [Repository Issues](https://github.com/your-repo/issues)
- Email: support@materio.app
- Documentation: [API Docs](https://docs.materio.app)

---

## License & Usage

This API is part of the Materio platform. See the main repository LICENSE file for terms and conditions.

**Rate Limits**: Please respect API rate limits and implement proper error handling.

**Data Privacy**: User data is handled according to our Privacy Policy. Personal information is encrypted and securely stored.

**API Versioning**: This is version 1 of the API. Breaking changes will be introduced in new versions with proper migration guides.
